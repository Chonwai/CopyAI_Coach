FROM python:3.9.5-slim

# RUN apt update && \
#     apt install -y bash \
#                    build-essential \
#                    git \
#                    curl \
#                    ca-certificates \
#                    rm -rf /var/lib/apt/lists
                #    python3.9 \
                #    python3-pip && \
    

RUN python3 -m pip install --no-cache-dir --upgrade pip && \
    python3 -m pip install --no-cache-dir --ignore-installed \
    tensorflow-cpu \
    torch \
    numpy \
    sklearn \
    future \
    thulac \
    tqdm \
    transformers==2.1.1

ENV GPT2_ROOT /app
RUN mkdir $GPT2_ROOT
WORKDIR $GPT2_ROOT

ARG PREFIX
ENV PREFIX=$PREFIX
RUN echo $PREFIX
ARG NSAMPLES
ENV NSAMPLES=$NSAMPLES
RUN echo $NSAMPLES
ARG MODEL_PATH
ENV MODEL_PATH=$MODEL_PATH
RUN echo $MODEL_PATH

COPY . .

# ENTRYPOINT [ "bash", "entrypoint.sh" ]
ENTRYPOINT [ "python3", "generate.py", "--prefix=$PREFIX", "--length=50", "--nsamples=5", "--model_path=$MODEL_PATH"]